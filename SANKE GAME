import sys
import random
from PyQt5.QtWidgets import QApplication, QMainWindow
from PyQt5.QtCore import Qt, QTimer
from PyQt5.QtGui import QPainter, QColor

CELL_SIZE = 20
GRID_SIZE = 30
WINDOW_SIZE = CELL_SIZE * GRID_SIZE

class Snake:
    def __init__(self):
        center = GRID_SIZE // 2
        self.body = [(center, center)]
        self.direction = (1, 0)  # moving right initially
        self.grow_pending = 0

    def move(self):
        head_x, head_y = self.body[0]
        dx, dy = self.direction
        new_head = ((head_x + dx) % GRID_SIZE, (head_y + dy) % GRID_SIZE)  # wrap around edges
        self.body.insert(0, new_head)

        if self.grow_pending > 0:
            self.grow_pending -= 1
        else:
            self.body.pop()

    def change_direction(self, new_dir):
        opposite = (-self.direction[0], -self.direction[1])
        if new_dir != opposite:  # prevent reversing
            self.direction = new_dir

    def grow(self):
        self.grow_pending += 1


class Food:
    def __init__(self):
        self.position = self.random_position()

    def random_position(self):
        return (random.randint(0, GRID_SIZE - 1), random.randint(0, GRID_SIZE - 1))

    def respawn(self):
        self.position = self.random_position()


class SnakeGame(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Snake Mechanics")
        self.setFixedSize(WINDOW_SIZE, WINDOW_SIZE)

        self.snake = Snake()
        self.food = Food()

        self.timer = QTimer(self)
        self.timer.timeout.connect(self.game_loop)
        self.timer.start(100)  # Faster = harder

    def game_loop(self):
        self.snake.move()

        # Check if snake eats food
        if self.snake.body[0] == self.food.position:
            self.snake.grow()
            self.food.respawn()

        self.update()

    def keyPressEvent(self, event):
        if event.key() == Qt.Key_Up:
            self.snake.change_direction((0, -1))
        elif event.key() == Qt.Key_Down:
            self.snake.change_direction((0, 1))
        elif event.key() == Qt.Key_Left:
            self.snake.change_direction((-1, 0))
        elif event.key() == Qt.Key_Right:
            self.snake.change_direction((1, 0))
        elif event.key() == Qt.Key_Q:
            QApplication.quit()

    def paintEvent(self, event):
        painter = QPainter(self)

        # Draw snake
        painter.setBrush(QColor(0, 255, 0))
        for x, y in self.snake.body:
            painter.drawRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE)

        # Draw food
        painter.setBrush(QColor(255, 0, 0))
        fx, fy = self.food.position
        painter.drawRect(fx * CELL_SIZE, fy * CELL_SIZE, CELL_SIZE, CELL_SIZE)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = SnakeGame()
    window.show()
    sys.exit(app.exec_())
    

